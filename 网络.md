### Post 和 Get





### HTTP 报文

**首部**：

​	请求行：**用于请求的方法**，**请求** **URI**，**HTTP** 版本

​	状态行：**状态码**，原因短语（例如 OK），HTTP 版本，

​    首部字段：Content-length, Content-type

空行：

**报文主体**：存储实际通信数据，







### 加密算法

非对称： RSA，DSA，ECDSA







# HTTP 的问题

从 HTTP 协议本身来看，其存在几大问题：

### 可能被 窃听

HTTP 本身不具备加密的功能，在互联网的线路上传输时，可能会被人收集，这样就会看到通信内容。

解决： 对信道加密（结合 SSL 和 TLS）； 对内容加密

### 内容可能被 篡改

HTTP 请求或响应在传输途中，可能遭到攻击者拦截并篡改，这种方式称为中间人攻击（Man-In-Middle attack). 

### 不验证身份

只要知道 IP 和端口，任何人都可以发起请求，服务器也会响应。解决：使用 SSL ，查看证书 CA， 证书由第三方颁发，客户端通信前先确认证书。



# HTTPS

https 的出现正是解决了这些问题，https 并不是一种新的协议，只是 HTTP 通信接口部分用 **SSL**（Secure Socket Layer）和 **TLS** ( Transport Layer Security)，其和 http 的区别简单来说就是：

**HTTP + 加密 + 完整性保护 + 身份认证 = HTTPS**



### SSL 的加密

SSL 的加密结合了 **共享密钥** 和 **公开密钥**。公开密钥更安全，但是通信效率比较低；因此 SSL 先使用 公开密钥加密方式来**传输在后面的共享密钥加密使用的密钥**，**确保交换的密钥安全后**，**使用共享密钥加密方式**进行通信。

但是，在第一次通信时，客户端无法证明公开密钥本身的真实性；为解决这种问题，服务器可以向数字证书认证机构申请一个数字签名，在通信时一并发给客户端，客户端拿着签名去验证即可。



# HTTPS 缺点

1. **耗费资源**

   与纯文本通信相比，加密通信会消耗服务器更多的资源

2. **速度慢**

   多了 SSL 通信部分，还有加密解密部分，整体速度比HTTP慢 2 到 100倍

3. **证书贵**

   要进行 HTTPS 通信，证书是必不可少的。而使用的证书必须向认 证机构（CA）购买。因此一些个人网站，可能无法负担这一开销



# 各种加密方式

#### 共享密钥加密

接收方和发送方使用同一把密钥进行解密和加密工作，发送方要把密钥发给接收方，在这个过程中 密钥 可能会泄漏，但是这种方式 加密，解密速度快； **AES**，**DES**

#### 公开密钥加密

**接收方生成，公钥和私钥**，公钥发给发送方，发送方使用 **公钥** 进行 **加密**，再把密文发送给接收方，接收方使用 **私钥** 进行 **解密**。

保证了 密钥 传递的安全，但是解密加密较慢，并且 公开密钥 在传递过程中可能被中间人截取，给发送方发一个错误的，中间人使用正确的公钥 加密 错误的信息给接收方，发送方，接收方并不知情（中间人攻击）

#### 混合密钥加密

使用公开密钥的方式 传递 共享密钥，确保 共享密钥 传输正确，之后用共享密钥来通信。

#### 消息认证码

防止密文被篡改，使用一个共享密钥对信息进行计算，得到（类似哈希值） MAC（message authentication code) 连同这个码发给接收方，接收方根据同样的密钥进行解密

但是，由于两方都可以自己生成 MAC，这个信息是自己伪造的还是真正发过来的没办法识别，

#### 数字签名

数字签名可以解决该事后否认的问题：发送者在发送时给消息加上数字签名，数字签名的生成使用公开密钥加密，发送者通过私钥生成，接收者使用公钥对签名进行解密，这样就可以确认消息的发送者。

但是无法保证公开密钥确实来自发送者，有可能被中间人替换

#### 数字证书

认证中心通过自己的私钥，对发送者的资料（发送者的公钥 以及 个人信息）生成数字签名，加上资料放到数字证书里，发给发送者，发送者再发给接收者，接收者通过认证中心的公钥对证书内对签名进行认证，来确认确实来自发送者。





## Cookie , Session， Token

这两个通常配合起来使用

cookie 存储在 客户端，**记录用户的一些信息**，例如自动填写表单，也可以存储 sessionid 来实现 session

session 在服务器，**用来跟踪用户状态**，例如购物车，这个数据可以保存在集群，数据库，文件中

token：加密后的用户信息，服务器通过解析 token，进行验权； 可以抵抗 **跨域攻击 CSRF**

jwt：由 3 部分拼接；

Header（头部）: 签名算法，令牌类型

Payload（负载）：实际数据 ； 这两个字段 用 base64 加密

Signature（签名）：对前两部分的签名，防止数据篡改。SHA256 加密上面的



```javascript
HMACSHA256(
  base64UrlEncode(header) + "." + 
  base64UrlEncode(payload),
  secret)
```



## CSRF

在伪造的页面中，嵌入恶意代码， 向被攻击网站发送 跨域请求。携带着用户的 cookie 来冒充用户。

一个典型的CSRF攻击有着如下的流程：

- 受害者登录a.com，并保留了登录凭证（Cookie）。
- 攻击者**引诱受害者访问了b.com**。
- **b.com 向 a.com 发送了一个请求**：a.com/act=xx。**浏览器会默认携带 a.com 的Cookie**。
- a.com接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是受害者自己发送的请求。
- a.com以受害者的名义执行了act=xx。
- 攻击完成，**攻击者在受害者不知情的情况下，冒充受害者，让a.com执行了自己定义的操作。**

### 解决

- CSRF自动防御策略：**同源检测**（检查 HTTP 头的 **Origin 和 Referer 验证**）。浏览器不允许获取不同源的 cookie
- CSRF主动防御措施：**Token验证** 或者 双重Cookie验证 以及配合 Samesite Cookie。



握手与挥手

![截屏2021-09-29 18.45.11](/Users/jon/Library/Application Support/typora-user-images/截屏2021-09-29 18.45.11.png)

挥手：

